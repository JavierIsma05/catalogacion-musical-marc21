{% extends "base.html" %} {% load static %} {% block extra_css %}
<style>
    /* Variables */
    :root {
        --border-light: #dee2e6;
        --bg-light: #f8f9fa;
        --text-muted: #6c757d;
        --sidebar-width: 220px;
    }

    /* Layout con sidebar */
    .page-container {
        display: flex;
        gap: 2rem;
        position: relative;
    }

    .form-content {
        flex: 1;
        max-width: 850px;
    }

    .sidebar-nav {
        width: var(--sidebar-width);
        position: sticky;
        top: 20px;
        align-self: flex-start;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
    }

    .sidebar-nav::-webkit-scrollbar {
        width: 6px;
    }

    .sidebar-nav::-webkit-scrollbar-thumb {
        background: var(--border-light);
        border-radius: 3px;
    }

    .nav-section {
        margin-bottom: 0.5rem;
    }

    .nav-section-title {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--text-muted);
        padding: 0.5rem 0.75rem;
        letter-spacing: 0.5px;
    }

    .nav-link {
        display: block;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        color: #495057;
        text-decoration: none;
        border-left: 3px solid transparent;
        transition: all 0.2s;
    }

    .nav-link:hover {
        background: var(--bg-light);
        color: #0d6efd;
        border-left-color: #0d6efd;
    }

    .nav-link.active {
        background: #e7f1ff;
        color: #0d6efd;
        border-left-color: #0d6efd;
        font-weight: 500;
    }

    /* Layout minimalista */
    .obra-container {
        width: 100%;
    }

    .section-title {
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-muted);
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border-light);
    }

    /* Campos repetibles */
    .campo-repetible {
        border: 1px solid var(--border-light);
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 0.75rem;
        background: white;
        transition: box-shadow 0.2s;
    }

    .campo-repetible:hover {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .campo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--bg-light);
    }

    .campo-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #495057;
    }

    .subcampo-group {
        background: var(--bg-light);
        padding: 0.75rem;
        border-radius: 0.25rem;
        margin-top: 0.5rem;
    }

    .subcampo-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
        display: block;
    }

    /* Botones minimalistas */
    .btn-add-field {
        font-size: 0.875rem;
        padding: 0.375rem 0.75rem;
    }

    .btn-remove {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
    }

    /* Form controls */
    .form-control,
    .form-select {
        font-size: 0.875rem;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.15);
    }

    /* Scroll suave */
    html {
        scroll-behavior: smooth;
        scroll-padding-top: 20px;
    }

    /* Responsive */
    @media (max-width: 992px) {
        .page-container {
            flex-direction: column-reverse;
        }

        .sidebar-nav {
            position: static;
            width: 100%;
            max-height: none;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 0.375rem;
        }

        .form-content {
            max-width: 100%;
        }
    }
</style>
{% endblock %} {% block content %}
<div class="container-fluid py-4">
    <div class="page-container">
        <!-- Contenido del formulario -->
        <div class="form-content">
            <div class="obra-container">
                <!-- Header -->
                <div class="mb-4">
                    <h1 class="h3 mb-1">Registrar Obra General</h1>
                    <p class="text-muted mb-0">
                        Catalogación MARC21 - Formato bibliográfico
                    </p>
                </div>

                <form method="post" id="obraForm">
                    {% csrf_token %}

                    <!-- Cabecera -->
                    <div class="card border-0 shadow-sm mb-4" id="cabecera">
                        <div class="card-body">
                            <h2 class="section-title">Cabecera</h2>

                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label small"
                                        >Tipo de Registro
                                        <span class="text-muted"
                                            >(Líder/06)</span
                                        ></label
                                    >
                                    <select
                                        name="tipo_registro"
                                        class="form-select"
                                        required
                                    >
                                        <option value="">Seleccionar...</option>
                                        <option value="c">
                                            c - Música notada manuscrita
                                        </option>
                                        <option value="d">
                                            d - Música notada impresa
                                        </option>
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label small"
                                        >Nivel Bibliográfico
                                        <span class="text-muted"
                                            >(Líder/07)</span
                                        ></label
                                    >
                                    <select
                                        name="nivel_bibliografico"
                                        class="form-select"
                                        required
                                    >
                                        <option value="">Seleccionar...</option>
                                        <option value="m">
                                            m - Monografía
                                        </option>
                                        <option value="c">c - Colección</option>
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label small"
                                        >Número de Control
                                        <span class="text-muted"
                                            >(001)</span
                                        ></label
                                    >
                                    <input
                                        type="text"
                                        name="num_control"
                                        class="form-control"
                                        placeholder="Ej: 001234"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 020 - ISBN (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4" id="bloque-0xx">
                        <div class="card-body">
                            <h2 class="section-title">020 - ISBN</h2>

                            <div id="isbn-container">
                                <div
                                    class="campo-repetible"
                                    data-campo="isbn-0"
                                >
                                    <div class="campo-header">
                                        <span class="campo-label">ISBN #1</span>
                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-remove"
                                            onclick="eliminarCampo('isbn-0')"
                                        >
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >$a ISBN</label
                                            >
                                            <input
                                                type="text"
                                                name="isbn_a_0"
                                                class="form-control"
                                                placeholder="978-0-123456-78-9"
                                            />
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >$q Calificador</label
                                            >
                                            <input
                                                type="text"
                                                name="isbn_q_0"
                                                class="form-control"
                                                placeholder="Ej: rústica"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-add-field"
                                onclick="agregarISBN()"
                            >
                                <i class="bi bi-plus-circle"></i> Agregar ISBN
                            </button>
                        </div>
                    </div>

                    <!-- 024 - ISMN (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">
                                024 - ISMN (Número Internacional Normalizado de
                                Música)
                            </h2>

                            <div id="ismn-container">
                                <div
                                    class="campo-repetible"
                                    data-campo="ismn-0"
                                >
                                    <div class="campo-header">
                                        <span class="campo-label">ISMN #1</span>
                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-remove"
                                            onclick="eliminarCampo('ismn-0')"
                                        >
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-12">
                                            <label class="subcampo-label"
                                                >$a ISMN</label
                                            >
                                            <input
                                                type="text"
                                                name="ismn_a_0"
                                                class="form-control"
                                                placeholder="M-001-12345-6-7"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-add-field"
                                onclick="agregarISMN()"
                            >
                                <i class="bi bi-plus-circle"></i> Agregar ISMN
                            </button>
                        </div>
                    </div>

                    <!-- 028 - Número de Editor (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">
                                028 - Número de Editor de Música
                            </h2>

                            <div id="numero-editor-container">
                                <div
                                    class="campo-repetible"
                                    data-campo="numero-editor-0"
                                >
                                    <div class="campo-header">
                                        <span class="campo-label"
                                            >Número de Editor #1</span
                                        >
                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-remove"
                                            onclick="eliminarCampo('numero-editor-0')"
                                        >
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-12">
                                            <label class="subcampo-label"
                                                >$a Número de Editor</label
                                            >
                                            <input
                                                type="text"
                                                name="numero_editor_a_0"
                                                class="form-control"
                                                placeholder="Ej: B. & H. 8797"
                                            />
                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >Indicador 1 - Tipo de
                                                Número</label
                                            >
                                            <select
                                                name="numero_editor_tipo_0"
                                                class="form-select"
                                            >
                                                <option value="0">
                                                    0 - Número de publicación
                                                </option>
                                                <option value="1">
                                                    1 - Número de matriz
                                                </option>
                                                <option value="2" selected>
                                                    2 - Número de plancha
                                                </option>
                                                <option value="3">
                                                    3 - Otro número de música
                                                </option>
                                                <option value="4">
                                                    4 - Número de videograbación
                                                </option>
                                                <option value="5">
                                                    5 - Otro número de editor
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >Indicador 2 - Control de
                                                Nota</label
                                            >
                                            <select
                                                name="numero_editor_control_0"
                                                class="form-select"
                                            >
                                                <option value="0" selected>
                                                    0 - No hay nota ni punto de
                                                    acceso adicional
                                                </option>
                                                <option value="1">
                                                    1 - Nota, hay punto de
                                                    acceso adicional
                                                </option>
                                                <option value="2">
                                                    2 - Nota, no hay punto de
                                                    acceso adicional
                                                </option>
                                                <option value="3">
                                                    3 - No hay nota, hay punto
                                                    de acceso adicional
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-add-field"
                                onclick="agregarNumeroEditor()"
                            >
                                <i class="bi bi-plus-circle"></i> Agregar Número
                                de Editor
                            </button>
                        </div>
                    </div>

                    <!-- 031 - Incipit Musical (Repetible con URLs repetibles) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">031 - Incipit Musical</h2>

                            <div id="incipit-container">
                                <div
                                    class="campo-repetible"
                                    data-campo="incipit-0"
                                >
                                    <div class="campo-header">
                                        <span class="campo-label"
                                            >Incipit #1</span
                                        >
                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-remove"
                                            onclick="eliminarCampo('incipit-0')"
                                        >
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>

                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <label class="subcampo-label"
                                                >$a Número de Obra</label
                                            >
                                            <input
                                                type="number"
                                                name="incipit_a_0"
                                                class="form-control"
                                                placeholder="1"
                                                value="1"
                                                min="1"
                                            />
                                        </div>
                                        <div class="col-md-4">
                                            <label class="subcampo-label"
                                                >$b Número de Movimiento</label
                                            >
                                            <input
                                                type="number"
                                                name="incipit_b_0"
                                                class="form-control"
                                                placeholder="1"
                                                value="1"
                                                min="1"
                                            />
                                        </div>
                                        <div class="col-md-4">
                                            <label class="subcampo-label"
                                                >$c Número de Pasaje</label
                                            >
                                            <input
                                                type="number"
                                                name="incipit_c_0"
                                                class="form-control"
                                                placeholder="1"
                                                value="1"
                                                min="1"
                                            />
                                        </div>
                                    </div>

                                    <div class="row g-2 mb-2">
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >$d Título o Encabezamiento
                                                (opcional)</label
                                            >
                                            <input
                                                type="text"
                                                name="incipit_d_0"
                                                class="form-control"
                                                placeholder="Ej: Aria, Allegro, Andante"
                                            />
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >$m Voz/Instrumento
                                                (opcional)</label
                                            >
                                            <input
                                                type="text"
                                                name="incipit_m_0"
                                                class="form-control"
                                                placeholder="Ej: V (solo si NO es piano)"
                                            />
                                        </div>
                                    </div>

                                    <div class="row g-2 mb-3">
                                        <div class="col-md-12">
                                            <label class="subcampo-label"
                                                >$p Notación Musical
                                                (opcional)</label
                                            >
                                            <textarea
                                                name="incipit_p_0"
                                                class="form-control"
                                                rows="2"
                                                placeholder="Código de incipit musical (Plaine & Easie, MusicXML, ABC)"
                                            ></textarea>
                                        </div>
                                    </div>

                                    <!-- URLs repetibles para este incipit -->
                                    <div class="subcampo-group">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-2"
                                        >
                                            <label class="subcampo-label mb-0"
                                                >$u URL Uniforme de
                                                Recursos</label
                                            >
                                            <button
                                                type="button"
                                                class="btn btn-outline-primary btn-sm"
                                                onclick="agregarURLIncipit(0)"
                                            >
                                                <i class="bi bi-plus"></i> URL
                                            </button>
                                        </div>
                                        <div id="incipit-0-urls">
                                            <div
                                                class="mb-2"
                                                data-subcampo="url-0-0"
                                            >
                                                <div
                                                    class="input-group input-group-sm"
                                                >
                                                    <input
                                                        type="url"
                                                        name="incipit_u_0_0"
                                                        class="form-control"
                                                        placeholder="https://..."
                                                    />
                                                    <button
                                                        type="button"
                                                        class="btn btn-outline-danger"
                                                        onclick="eliminarSubcampo('url-0-0')"
                                                    >
                                                        <i class="bi bi-x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-add-field"
                                onclick="agregarIncipit()"
                            >
                                <i class="bi bi-plus-circle"></i> Agregar
                                Incipit
                            </button>
                        </div>
                    </div>

                    <!-- 040 - Fuente de Catalogación -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">
                                040 - Fuente de Catalogación
                            </h2>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small"
                                        >$a Centro Catalogador</label
                                    >
                                    <input
                                        type="text"
                                        name="centro_catalogador"
                                        class="form-control"
                                        value="UNL"
                                        placeholder="UNL"
                                        maxlength="10"
                                    />
                                    <small class="text-muted"
                                        >Predeterminado: UNL</small
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 041 - Código de Lengua (Repetible con idiomas repetibles) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">
                                041 - Código de Lengua
                            </h2>

                            <div id="codigo-lengua-container">
                                <div
                                    class="campo-repetible"
                                    data-campo="codigo-lengua-0"
                                >
                                    <div class="campo-header">
                                        <span class="campo-label"
                                            >Código de Lengua #1</span
                                        >
                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-remove"
                                            onclick="eliminarCampo('codigo-lengua-0')"
                                        >
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>

                                    <div class="row g-2 mb-3">
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >Indicador 1 - Código de
                                                Traducción</label
                                            >
                                            <select
                                                name="codigo_lengua_ind1_0"
                                                class="form-select"
                                            >
                                                <option value="#">
                                                    # - No se proporciona
                                                    información
                                                </option>
                                                <option value="0" selected>
                                                    0 - No es traducción
                                                </option>
                                                <option value="1">
                                                    1 - Es traducción
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label"
                                                >Indicador 2 - Código de
                                                Fuente</label
                                            >
                                            <select
                                                name="codigo_lengua_ind2_0"
                                                class="form-select"
                                            >
                                                <option value="#" selected>
                                                    # - Código MARC de lengua
                                                </option>
                                                <option value="7">
                                                    7 - Fuente especificada en
                                                    $2
                                                </option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Idiomas repetibles -->
                                    <div class="subcampo-group">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-2"
                                        >
                                            <label class="subcampo-label mb-0"
                                                >$a Código de Lengua del
                                                Texto/Banda Sonora</label
                                            >
                                            <button
                                                type="button"
                                                class="btn btn-outline-primary btn-sm"
                                                onclick="agregarIdiomaObra(0)"
                                            >
                                                <i class="bi bi-plus"></i>
                                                Idioma
                                            </button>
                                        </div>
                                        <div id="codigo-lengua-0-idiomas">
                                            <div
                                                class="mb-2"
                                                data-subcampo="idioma-0-0"
                                            >
                                                <div
                                                    class="input-group input-group-sm"
                                                >
                                                    <select
                                                        name="codigo_lengua_a_0_0"
                                                        class="form-select form-select-sm"
                                                    >
                                                        <option value="ger">
                                                            Alemán
                                                        </option>
                                                        <option
                                                            value="spa"
                                                            selected
                                                        >
                                                            Español
                                                        </option>
                                                        <option value="fre">
                                                            Francés
                                                        </option>
                                                        <option value="eng">
                                                            Inglés
                                                        </option>
                                                        <option value="ita">
                                                            Italiano
                                                        </option>
                                                        <option value="por">
                                                            Portugués
                                                        </option>
                                                    </select>
                                                    <button
                                                        type="button"
                                                        class="btn btn-outline-danger"
                                                        onclick="eliminarSubcampo('idioma-0-0')"
                                                    >
                                                        <i class="bi bi-x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-add-field"
                                onclick="agregarCodigoLengua()"
                            >
                                <i class="bi bi-plus-circle"></i> Agregar Código
                                de Lengua
                            </button>
                        </div>
                    </div>

                    <!-- 044 - Código de País (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">
                                044 - Código de País de Entidad
                                Productora/Editora
                            </h2>

                            <div id="codigo-pais-container">
                                <div
                                    class="campo-repetible"
                                    data-campo="codigo-pais-0"
                                >
                                    <div class="campo-header">
                                        <span class="campo-label"
                                            >Código de País #1</span
                                        >
                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-remove"
                                            onclick="eliminarCampo('codigo-pais-0')"
                                        >
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-12">
                                            <label class="subcampo-label"
                                                >$a Código de País</label
                                            >
                                            <select
                                                name="codigo_pais_a_0"
                                                class="form-select"
                                            >
                                                <option value="ar">
                                                    Argentina
                                                </option>
                                                <option value="bo">
                                                    Bolivia
                                                </option>
                                                <option value="br">
                                                    Brasil
                                                </option>
                                                <option value="cl">
                                                    Chile
                                                </option>
                                                <option value="co">
                                                    Colombia
                                                </option>
                                                <option value="cr">
                                                    Costa Rica
                                                </option>
                                                <option value="cu">Cuba</option>
                                                <option value="ec" selected>
                                                    Ecuador
                                                </option>
                                                <option value="sv">
                                                    El Salvador
                                                </option>
                                                <option value="gt">
                                                    Guatemala
                                                </option>
                                                <option value="ho">
                                                    Honduras
                                                </option>
                                                <option value="mx">
                                                    México
                                                </option>
                                                <option value="nq">
                                                    Nicaragua
                                                </option>
                                                <option value="pa">
                                                    Panamá
                                                </option>
                                                <option value="pe">Perú</option>
                                                <option value="pr">
                                                    Puerto Rico
                                                </option>
                                                <option value="dr">
                                                    República Dominicana
                                                </option>
                                                <option value="uy">
                                                    Uruguay
                                                </option>
                                                <option value="ve">
                                                    Venezuela
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-add-field"
                                onclick="agregarCodigoPais()"
                            >
                                <i class="bi bi-plus-circle"></i> Agregar Código
                                de País
                            </button>
                        </div>
                    </div>

                    <!-- 092 - Clasificación Local -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">
                                092 - Clasificación Local
                            </h2>

                            <div class="alert alert-info" role="alert">
                                <i class="bi bi-info-circle"></i>
                                <small>
                                    Los campos de este bloque se generan
                                    automáticamente a partir de otros campos. Se
                                    completan al guardar la obra.
                                </small>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small"
                                        >$a Institución</label
                                    >
                                    <input
                                        type="text"
                                        name="clasif_institucion"
                                        class="form-control"
                                        value="UNL"
                                        readonly
                                        disabled
                                    />
                                    <small class="text-muted"
                                        >Copia del campo 040 $a</small
                                    >
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label small"
                                        >$b Proyecto</label
                                    >
                                    <input
                                        type="text"
                                        name="clasif_proyecto"
                                        class="form-control"
                                        value="BLMP"
                                        readonly
                                        disabled
                                    />
                                    <small class="text-muted"
                                        >Predeterminado: BLMP</small
                                    >
                                </div>
                            </div>

                            <div class="row g-3 mt-2">
                                <div class="col-md-4">
                                    <label class="form-label small"
                                        >$c País</label
                                    >
                                    <input
                                        type="text"
                                        name="clasif_pais"
                                        class="form-control"
                                        readonly
                                        disabled
                                        placeholder="Del campo 044 $a"
                                    />
                                    <small class="text-muted"
                                        >Copia del primer país (044 $a)</small
                                    >
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label small"
                                        >$d Ms/Imp</label
                                    >
                                    <input
                                        type="text"
                                        name="clasif_ms_imp"
                                        class="form-control"
                                        readonly
                                        disabled
                                        placeholder="Ms o Imp"
                                    />
                                    <small class="text-muted"
                                        >Según tipo de registro
                                        (Líder/06)</small
                                    >
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label small"
                                        >$0 Número de Control</label
                                    >
                                    <input
                                        type="text"
                                        name="clasif_num_control"
                                        class="form-control"
                                        readonly
                                        disabled
                                        placeholder="Del campo 001"
                                    />
                                    <small class="text-muted"
                                        >Copia del campo 001</small
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="d-flex gap-2 justify-content-end">
                        <a
                            href="{% url 'index' %}"
                            class="btn btn-outline-secondary"
                            >Cancelar</a
                        >
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Guardar Obra
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar de navegación -->
        <div class="sidebar-nav">
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Navegación</div>
                    <a href="#cabecera" class="nav-link active">Cabecera</a>
                    <a href="#bloque-0xx" class="nav-link"
                        >0XX - Campos de Control</a
                    >
                </div>
            </nav>
        </div>
    </div>
</div>
{% endblock %} {% block extra_js %}
<script>
    // Contadores globales para campos repetibles
    let isbnCount = 1;
    let ismnCount = 1;
    let numeroEditorCount = 1;
    let incipitCount = 1;
    let codigoLenguaCount = 1;
    let codigoPaisCount = 1;

    // Contadores para subcampos repetibles (estructura: {incipitIndex: urlCount})
    const incipitURLCounts = { 0: 1 };
    const codigoLenguaIdiomaCounts = { 0: 1 };

    // Función genérica para eliminar campos
    function eliminarCampo(campoId) {
        const campo = document.querySelector(`[data-campo="${campoId}"]`);
        if (campo) {
            campo.remove();
        }
    }

    // Función genérica para eliminar subcampos
    function eliminarSubcampo(subcampoId) {
        const subcampo = document.querySelector(
            `[data-subcampo="${subcampoId}"]`
        );
        if (subcampo) {
            subcampo.remove();
        }
    }

    // 020 - ISBN
    function agregarISBN() {
        const container = document.getElementById("isbn-container");
        const campoId = `isbn-${isbnCount}`;

        const html = `
            <div class="campo-repetible" data-campo="${campoId}">
                <div class="campo-header">
                    <span class="campo-label">ISBN #${isbnCount + 1}</span>
                    <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('${campoId}')">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
                <div class="row g-2">
                    <div class="col-md-6">
                        <label class="subcampo-label">$a ISBN</label>
                        <input type="text" name="isbn_a_${isbnCount}" class="form-control" placeholder="978-0-123456-78-9">
                    </div>
                    <div class="col-md-6">
                        <label class="subcampo-label">$q Calificador</label>
                        <input type="text" name="isbn_q_${isbnCount}" class="form-control" placeholder="Ej: rústica">
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        isbnCount++;
    }

    // 024 - ISMN
    function agregarISMN() {
        const container = document.getElementById("ismn-container");
        const campoId = `ismn-${ismnCount}`;

        const html = `
            <div class="campo-repetible" data-campo="${campoId}">
                <div class="campo-header">
                    <span class="campo-label">ISMN #${ismnCount + 1}</span>
                    <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('${campoId}')">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
                <div class="row g-2">
                    <div class="col-md-12">
                        <label class="subcampo-label">$a ISMN</label>
                        <input type="text" name="ismn_a_${ismnCount}" class="form-control" placeholder="M-001-12345-6-7">
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        ismnCount++;
    }

    // 028 - Número de Editor
    function agregarNumeroEditor() {
        const container = document.getElementById("numero-editor-container");
        const campoId = `numero-editor-${numeroEditorCount}`;

        const html = `
            <div class="campo-repetible" data-campo="${campoId}">
                <div class="campo-header">
                    <span class="campo-label">Número de Editor #${
                        numeroEditorCount + 1
                    }</span>
                    <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('${campoId}')">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
                <div class="row g-2 mb-2">
                    <div class="col-md-12">
                        <label class="subcampo-label">$a Número de Editor</label>
                        <input type="text" name="numero_editor_a_${numeroEditorCount}" class="form-control" placeholder="Ej: B. & H. 8797">
                    </div>
                </div>
                <div class="row g-2">
                    <div class="col-md-6">
                        <label class="subcampo-label">Indicador 1 - Tipo de Número</label>
                        <select name="numero_editor_tipo_${numeroEditorCount}" class="form-select">
                            <option value="0">0 - Número de publicación</option>
                            <option value="1">1 - Número de matriz</option>
                            <option value="2" selected>2 - Número de plancha</option>
                            <option value="3">3 - Otro número de música</option>
                            <option value="4">4 - Número de videograbación</option>
                            <option value="5">5 - Otro número de editor</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="subcampo-label">Indicador 2 - Control de Nota</label>
                        <select name="numero_editor_control_${numeroEditorCount}" class="form-select">
                            <option value="0" selected>0 - No hay nota ni punto de acceso adicional</option>
                            <option value="1">1 - Nota, hay punto de acceso adicional</option>
                            <option value="2">2 - Nota, no hay punto de acceso adicional</option>
                            <option value="3">3 - No hay nota, hay punto de acceso adicional</option>
                        </select>
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        numeroEditorCount++;
    }

    // 031 - Incipit Musical (con URLs repetibles)
    function agregarIncipit() {
        const container = document.getElementById("incipit-container");
        const campoId = `incipit-${incipitCount}`;

        // Inicializar contador de URLs para este incipit
        incipitURLCounts[incipitCount] = 1;

        const html = `
            <div class="campo-repetible" data-campo="${campoId}">
                <div class="campo-header">
                    <span class="campo-label">Incipit #${
                        incipitCount + 1
                    }</span>
                    <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('${campoId}')">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
                
                <div class="row g-2 mb-2">
                    <div class="col-md-4">
                        <label class="subcampo-label">$a Número de Obra</label>
                        <input type="number" name="incipit_a_${incipitCount}" class="form-control" placeholder="1" value="1" min="1">
                    </div>
                    <div class="col-md-4">
                        <label class="subcampo-label">$b Número de Movimiento</label>
                        <input type="number" name="incipit_b_${incipitCount}" class="form-control" placeholder="1" value="1" min="1">
                    </div>
                    <div class="col-md-4">
                        <label class="subcampo-label">$c Número de Pasaje</label>
                        <input type="number" name="incipit_c_${incipitCount}" class="form-control" placeholder="1" value="1" min="1">
                    </div>
                </div>
                
                <div class="row g-2 mb-2">
                    <div class="col-md-6">
                        <label class="subcampo-label">$d Título o Encabezamiento (opcional)</label>
                        <input type="text" name="incipit_d_${incipitCount}" class="form-control" placeholder="Ej: Aria, Allegro, Andante">
                    </div>
                    <div class="col-md-6">
                        <label class="subcampo-label">$m Voz/Instrumento (opcional)</label>
                        <input type="text" name="incipit_m_${incipitCount}" class="form-control" placeholder="Ej: V (solo si NO es piano)">
                    </div>
                </div>
                
                <div class="row g-2 mb-3">
                    <div class="col-md-12">
                        <label class="subcampo-label">$p Notación Musical (opcional)</label>
                        <textarea name="incipit_p_${incipitCount}" class="form-control" rows="2" placeholder="Código de incipit musical (Plaine & Easie, MusicXML, ABC)"></textarea>
                    </div>
                </div>

                <div class="subcampo-group">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="subcampo-label mb-0">$u URL Uniforme de Recursos</label>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarURLIncipit(${incipitCount})">
                            <i class="bi bi-plus"></i> URL
                        </button>
                    </div>
                    <div id="incipit-${incipitCount}-urls">
                        <div class="mb-2" data-subcampo="url-${incipitCount}-0">
                            <div class="input-group input-group-sm">
                                <input type="url" name="incipit_u_${incipitCount}_0" class="form-control" placeholder="https://...">
                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('url-${incipitCount}-0')">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        incipitCount++;
    }

    // Agregar URL a un incipit específico
    function agregarURLIncipit(incipitIndex) {
        const container = document.getElementById(
            `incipit-${incipitIndex}-urls`
        );
        const urlIndex = incipitURLCounts[incipitIndex];
        const subcampoId = `url-${incipitIndex}-${urlIndex}`;

        const html = `
            <div class="mb-2" data-subcampo="${subcampoId}">
                <div class="input-group input-group-sm">
                    <input type="url" name="incipit_u_${incipitIndex}_${urlIndex}" class="form-control" placeholder="https://...">
                    <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('${subcampoId}')">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        incipitURLCounts[incipitIndex]++;
    }

    // 041 - Código de Lengua (con idiomas repetibles)
    function agregarCodigoLengua() {
        const container = document.getElementById("codigo-lengua-container");
        const campoId = `codigo-lengua-${codigoLenguaCount}`;

        // Inicializar contador de idiomas para este código
        codigoLenguaIdiomaCounts[codigoLenguaCount] = 1;

        const html = `
            <div class="campo-repetible" data-campo="${campoId}">
                <div class="campo-header">
                    <span class="campo-label">Código de Lengua #${
                        codigoLenguaCount + 1
                    }</span>
                    <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('${campoId}')">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
                
                <div class="row g-2 mb-3">
                    <div class="col-md-6">
                        <label class="subcampo-label">Indicador 1 - Código de Traducción</label>
                        <select name="codigo_lengua_ind1_${codigoLenguaCount}" class="form-select">
                            <option value="#"># - No se proporciona información</option>
                            <option value="0" selected>0 - No es traducción</option>
                            <option value="1">1 - Es traducción</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="subcampo-label">Indicador 2 - Código de Fuente</label>
                        <select name="codigo_lengua_ind2_${codigoLenguaCount}" class="form-select">
                            <option value="#" selected># - Código MARC de lengua</option>
                            <option value="7">7 - Fuente especificada en $2</option>
                        </select>
                    </div>
                </div>

                <div class="subcampo-group">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="subcampo-label mb-0">$a Código de Lengua del Texto/Banda Sonora</label>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarIdiomaObra(${codigoLenguaCount})">
                            <i class="bi bi-plus"></i> Idioma
                        </button>
                    </div>
                    <div id="codigo-lengua-${codigoLenguaCount}-idiomas">
                        <div class="mb-2" data-subcampo="idioma-${codigoLenguaCount}-0">
                            <div class="input-group input-group-sm">
                                <select name="codigo_lengua_a_${codigoLenguaCount}_0" class="form-select form-select-sm">
                                    <option value="ger">Alemán</option>
                                    <option value="spa" selected>Español</option>
                                    <option value="fre">Francés</option>
                                    <option value="eng">Inglés</option>
                                    <option value="ita">Italiano</option>
                                    <option value="por">Portugués</option>
                                </select>
                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('idioma-${codigoLenguaCount}-0')">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        codigoLenguaCount++;
    }

    // Agregar idioma a un código de lengua específico
    function agregarIdiomaObra(codigoIndex) {
        const container = document.getElementById(
            `codigo-lengua-${codigoIndex}-idiomas`
        );
        const idiomaIndex = codigoLenguaIdiomaCounts[codigoIndex];
        const subcampoId = `idioma-${codigoIndex}-${idiomaIndex}`;

        const html = `
            <div class="mb-2" data-subcampo="${subcampoId}">
                <div class="input-group input-group-sm">
                    <select name="codigo_lengua_a_${codigoIndex}_${idiomaIndex}" class="form-select form-select-sm">
                        <option value="ger">Alemán</option>
                        <option value="spa" selected>Español</option>
                        <option value="fre">Francés</option>
                        <option value="eng">Inglés</option>
                        <option value="ita">Italiano</option>
                        <option value="por">Portugués</option>
                    </select>
                    <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('${subcampoId}')">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        codigoLenguaIdiomaCounts[codigoIndex]++;
    }

    // 044 - Código de País
    function agregarCodigoPais() {
        const container = document.getElementById("codigo-pais-container");
        const campoId = `codigo-pais-${codigoPaisCount}`;

        const html = `
            <div class="campo-repetible" data-campo="${campoId}">
                <div class="campo-header">
                    <span class="campo-label">Código de País #${
                        codigoPaisCount + 1
                    }</span>
                    <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('${campoId}')">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
                <div class="row g-2">
                    <div class="col-md-12">
                        <label class="subcampo-label">$a Código de País</label>
                        <select name="codigo_pais_a_${codigoPaisCount}" class="form-select">
                            <option value="ar">Argentina</option>
                            <option value="bo">Bolivia</option>
                            <option value="br">Brasil</option>
                            <option value="cl">Chile</option>
                            <option value="co">Colombia</option>
                            <option value="cr">Costa Rica</option>
                            <option value="cu">Cuba</option>
                            <option value="ec" selected>Ecuador</option>
                            <option value="sv">El Salvador</option>
                            <option value="gt">Guatemala</option>
                            <option value="ho">Honduras</option>
                            <option value="mx">México</option>
                            <option value="nq">Nicaragua</option>
                            <option value="pa">Panamá</option>
                            <option value="pe">Perú</option>
                            <option value="pr">Puerto Rico</option>
                            <option value="dr">República Dominicana</option>
                            <option value="uy">Uruguay</option>
                            <option value="ve">Venezuela</option>
                        </select>
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
        codigoPaisCount++;
    }

    // Scroll-spy para sidebar
    document.addEventListener("DOMContentLoaded", function () {
        const sections = document.querySelectorAll("[id]");
        const navLinks = document.querySelectorAll(".sidebar-nav .nav-link");

        function changeActiveLink() {
            let index = sections.length;

            while (
                --index &&
                window.scrollY + 100 < sections[index].offsetTop
            ) {}

            navLinks.forEach((link) => link.classList.remove("active"));
            if (navLinks[index]) {
                navLinks[index].classList.add("active");
            }
        }

        changeActiveLink();
        window.addEventListener("scroll", changeActiveLink);

        // Smooth scroll al hacer clic
        navLinks.forEach((link) => {
            link.addEventListener("click", function (e) {
                e.preventDefault();
                const targetId = this.getAttribute("href");
                const targetSection = document.querySelector(targetId);

                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: "smooth" });
                }
            });
        });
    });
</script>
{% endblock %}
