{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'catalogacion/css/obra-general.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="page-container">
        <!-- Contenido del formulario -->
        <div class="form-content">
            <div class="obra-container">
                <!-- Header -->
                <div class="mb-4">
                    <h1 class="h3 mb-1">Registrar Obra General</h1>
                    <p class="text-muted mb-0">Catalogación MARC21 - Formato bibliográfico</p>
                </div>

                <form method="post" id="obraForm">
                    {% csrf_token %}

                    <!-- Cabecera -->
                    <div class="card border-0 shadow-sm mb-4" id="cabecera">
                        <div class="card-body">
                            <h2 class="section-title">Cabecera</h2>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label small">Tipo de Registro <span class="text-muted">(Líder/06)</span></label>
                                    <select name="tipo_registro" class="form-select" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="c">c - Música notada manuscrita</option>
                                        <option value="d">d - Música notada impresa</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Nivel Bibliográfico <span class="text-muted">(Líder/07)</span></label>
                                    <select name="nivel_bibliografico" class="form-select" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="m">m - Monografía</option>
                                        <option value="c">c - Colección</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Número de Control <span class="text-muted">(001)</span></label>
                                    <input type="text" name="num_control" class="form-control" placeholder="Ej: 001234">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 020 - ISBN (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4" id="bloque-0xx">
                        <div class="card-body">
                            <h2 class="section-title">020 - ISBN</h2>
                            <div id="isbn-container">
                                <div class="campo-repetible" data-campo="isbn-0">
                                    <div class="campo-header">
                                        <span class="campo-label">ISBN #1</span>
                                        <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('isbn-0')">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <label class="subcampo-label">$a ISBN</label>
                                            <input type="text" name="isbn_a_0" class="form-control" placeholder="978-0-123456-78-9">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label">$q Calificador</label>
                                            <input type="text" name="isbn_q_0" class="form-control" placeholder="Ej: rústica">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-add-field" onclick="agregarISBN()">
                                <i class="bi bi-plus-circle"></i> Agregar ISBN
                            </button>
                        </div>
                    </div>

                    <!-- 024 - ISMN (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">024 - ISMN (Número Internacional Normalizado de Música)</h2>
                            <div id="ismn-container">
                                <div class="campo-repetible" data-campo="ismn-0">
                                    <div class="campo-header">
                                        <span class="campo-label">ISMN #1</span>
                                        <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('ismn-0')">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-12">
                                            <label class="subcampo-label">$a ISMN</label>
                                            <input type="text" name="ismn_a_0" class="form-control" placeholder="M-001-12345-6-7">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-add-field" onclick="agregarISMN()">
                                <i class="bi bi-plus-circle"></i> Agregar ISMN
                            </button>
                        </div>
                    </div>

                    <!-- 028 - Número de Editor (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">028 - Número de Editor de Música</h2>
                            <div id="numero-editor-container">
                                <div class="campo-repetible" data-campo="numero-editor-0">
                                    <div class="campo-header">
                                        <span class="campo-label">Número de Editor #1</span>
                                        <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('numero-editor-0')">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-12">
                                            <label class="subcampo-label">$a Número de Editor</label>
                                            <input type="text" name="numero_editor_a_0" class="form-control" placeholder="Ej: B. & H. 8797">
                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <label class="subcampo-label">Indicador 1 - Tipo de Número</label>
                                            <select name="numero_editor_tipo_0" class="form-select">
                                                <option value="0">0 - Número de publicación</option>
                                                <option value="1">1 - Número de matriz</option>
                                                <option value="2" selected>2 - Número de plancha</option>
                                                <option value="3">3 - Otro número de música</option>
                                                <option value="4">4 - Número de videograbación</option>
                                                <option value="5">5 - Otro número de editor</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label">Indicador 2 - Control de Nota</label>
                                            <select name="numero_editor_control_0" class="form-select">
                                                <option value="0" selected>0 - No hay nota ni punto de acceso adicional</option>
                                                <option value="1">1 - Nota, hay punto de acceso adicional</option>
                                                <option value="2">2 - Nota, no hay punto de acceso adicional</option>
                                                <option value="3">3 - No hay nota, hay punto de acceso adicional</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-add-field" onclick="agregarNumeroEditor()">
                                <i class="bi bi-plus-circle"></i> Agregar Número de Editor
                            </button>
                        </div>
                    </div>

                    <!-- 031 - Incipit Musical (Repetible con URLs repetibles) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">031 - Incipit Musical</h2>
                            <div id="incipit-container">
                                <div class="campo-repetible" data-campo="incipit-0">
                                    <div class="campo-header">
                                        <span class="campo-label">Incipit #1</span>
                                        <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('incipit-0')">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>

                                    <div class="row g-2 mb-2">
                                        <div class="col-md-4">
                                            <label class="subcampo-label">$a Número de Obra</label>
                                            <input type="number" name="incipit_a_0" class="form-control" placeholder="1" value="1" min="1">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="subcampo-label">$b Número de Movimiento</label>
                                            <input type="number" name="incipit_b_0" class="form-control" placeholder="1" value="1" min="1">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="subcampo-label">$c Número de Pasaje</label>
                                            <input type="number" name="incipit_c_0" class="form-control" placeholder="1" value="1" min="1">
                                        </div>
                                    </div>

                                    <div class="row g-2 mb-2">
                                        <div class="col-md-6">
                                            <label class="subcampo-label">$d Título o Encabezamiento (opcional)</label>
                                            <input type="text" name="incipit_d_0" class="form-control" placeholder="Ej: Aria, Allegro, Andante">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label">$m Voz/Instrumento (opcional)</label>
                                            <input type="text" name="incipit_m_0" class="form-control" placeholder="Ej: V (solo si NO es piano)">
                                        </div>
                                    </div>

                                    <div class="row g-2 mb-3">
                                        <div class="col-md-12">
                                            <label class="subcampo-label">$p Notación Musical (opcional)</label>
                                            <textarea name="incipit_p_0" class="form-control" rows="2" placeholder="Código de incipit musical (Plaine & Easie, MusicXML, ABC)"></textarea>
                                        </div>
                                    </div>

                                    <!-- URLs repetibles para este incipit -->
                                    <div class="subcampo-group">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="subcampo-label mb-0">$u URL Uniforme de Recursos</label>
                                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarURLIncipit(0)">
                                                <i class="bi bi-plus"></i> URL
                                            </button>
                                        </div>
                                        <div id="incipit-0-urls">
                                            <div class="mb-2" data-subcampo="url-0-0">
                                                <div class="input-group input-group-sm">
                                                    <input type="url" name="incipit_u_0_0" class="form-control" placeholder="https://...">
                                                    <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('url-0-0')">
                                                        <i class="bi bi-x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-add-field" onclick="agregarIncipit()">
                                <i class="bi bi-plus-circle"></i> Agregar Incipit
                            </button>
                        </div>
                    </div>

                    <!-- 040 - Fuente de Catalogación -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">040 - Fuente de Catalogación</h2>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small">$a Centro Catalogador</label>
                                    <input type="text" name="centro_catalogador" class="form-control" value="UNL" placeholder="UNL" maxlength="10">
                                    <small class="text-muted">Predeterminado: UNL</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 041 - Código de Lengua (Repetible con idiomas repetibles) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">041 - Código de Lengua</h2>
                            <div id="codigo-lengua-container">
                                <div class="campo-repetible" data-campo="codigo-lengua-0">
                                    <div class="campo-header">
                                        <span class="campo-label">Código de Lengua #1</span>
                                        <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('codigo-lengua-0')">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>

                                    <div class="row g-2 mb-3">
                                        <div class="col-md-6">
                                            <label class="subcampo-label">Indicador 1 - Código de Traducción</label>
                                            <select name="codigo_lengua_ind1_0" class="form-select">
                                                <option value="#"># - No se proporciona información</option>
                                                <option value="0" selected>0 - No es traducción</option>
                                                <option value="1">1 - Es traducción</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="subcampo-label">Indicador 2 - Código de Fuente</label>
                                            <select name="codigo_lengua_ind2_0" class="form-select">
                                                <option value="#" selected># - Código MARC de lengua</option>
                                                <option value="7">7 - Fuente especificada en $2</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Idiomas repetibles -->
                                    <div class="subcampo-group">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="subcampo-label mb-0">$a Código de Lengua del Texto/Banda Sonora</label>
                                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarIdiomaObra(0)">
                                                <i class="bi bi-plus"></i> Idioma
                                            </button>
                                        </div>
                                        <div id="codigo-lengua-0-idiomas">
                                            <div class="mb-2" data-subcampo="idioma-0-0">
                                                <div class="input-group input-group-sm">
                                                    <select name="codigo_lengua_a_0_0" class="form-select form-select-sm">
                                                        <option value="ger">Alemán</option>
                                                        <option value="spa" selected>Español</option>
                                                        <option value="fre">Francés</option>
                                                        <option value="eng">Inglés</option>
                                                        <option value="ita">Italiano</option>
                                                        <option value="por">Portugués</option>
                                                    </select>
                                                    <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('idioma-0-0')">
                                                        <i class="bi bi-x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-add-field" onclick="agregarCodigoLengua()">
                                <i class="bi bi-plus-circle"></i> Agregar Código de Lengua
                            </button>
                        </div>
                    </div>

                    <!-- 044 - Código de País (Repetible) -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">044 - Código de País de Entidad Productora/Editora</h2>
                            <div id="codigo-pais-container">
                                <div class="campo-repetible" data-campo="codigo-pais-0">
                                    <div class="campo-header">
                                        <span class="campo-label">Código de País #1</span>
                                        <button type="button" class="btn btn-outline-danger btn-remove" onclick="eliminarCampo('codigo-pais-0')">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-md-12">
                                            <label class="subcampo-label">$a Código de País</label>
                                            <select name="codigo_pais_a_0" class="form-select">
                                                <option value="ar">Argentina</option>
                                                <option value="bo">Bolivia</option>
                                                <option value="br">Brasil</option>
                                                <option value="cl">Chile</option>
                                                <option value="co">Colombia</option>
                                                <option value="cr">Costa Rica</option>
                                                <option value="cu">Cuba</option>
                                                <option value="ec" selected>Ecuador</option>
                                                <option value="sv">El Salvador</option>
                                                <option value="gt">Guatemala</option>
                                                <option value="ho">Honduras</option>
                                                <option value="mx">México</option>
                                                <option value="nq">Nicaragua</option>
                                                <option value="pa">Panamá</option>
                                                <option value="pe">Perú</option>
                                                <option value="pr">Puerto Rico</option>
                                                <option value="dr">República Dominicana</option>
                                                <option value="uy">Uruguay</option>
                                                <option value="ve">Venezuela</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-add-field" onclick="agregarCodigoPais()">
                                <i class="bi bi-plus-circle"></i> Agregar Código de País
                            </button>
                        </div>
                    </div>

                    <!-- 092 - Clasificación Local -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h2 class="section-title">092 - Clasificación Local</h2>
                            <div class="alert alert-info" role="alert">
                                <i class="bi bi-info-circle"></i>
                                <small>Los campos de este bloque se generan automáticamente a partir de otros campos. Se completan al guardar la obra.</small>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small">$a Institución</label>
                                    <input type="text" name="clasif_institucion" class="form-control" value="UNL" readonly disabled>
                                    <small class="text-muted">Copia del campo 040 $a</small>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">$b Proyecto</label>
                                    <input type="text" name="clasif_proyecto" class="form-control" value="BLMP" readonly disabled>
                                    <small class="text-muted">Predeterminado: BLMP</small>
                                </div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-md-4">
                                    <label class="form-label small">$c País</label>
                                    <input type="text" name="clasif_pais" class="form-control" readonly disabled placeholder="Del campo 044 $a">
                                    <small class="text-muted">Copia del primer país (044 $a)</small>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">$d Ms/Imp</label>
                                    <input type="text" name="clasif_ms_imp" class="form-control" readonly disabled placeholder="Ms o Imp">
                                    <small class="text-muted">Según tipo de registro (Líder/06)</small>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">$0 Número de Control</label>
                                    <input type="text" name="clasif_num_control" class="form-control" readonly disabled placeholder="Del campo 001">
                                    <small class="text-muted">Copia del campo 001</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!--? BLOQUE 1XX - ENTRADAS PRINCIPALES -->
                    <!-- ============================================ -->

                    <div class="card border-0 shadow-sm mb-4" id="bloque-1xx">
                        <div class="card-body">
                            <h2 class="section-title">Campos 1XX - Entradas Principales</h2>
                            
                            <!-- 100 - COMPOSITOR (con subcampos repetibles) -->
                            <div class="mb-4">
                                <h3 class="h6 mb-3">100 - Compositor</h3>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-12">
                                        <label class="form-label small">$a Nombre del Compositor</label>
                                        <input type="text" name="compositor_a" class="form-control" 
                                               placeholder="Apellido, Nombre">
                                    </div>
                                </div>


                                <!-- Subcampo $e - Función (Repetible) -->
                                <div class="subcampo-group">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$e Término de la Función</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarFuncionCompositor()">
                                            <i class="bi bi-plus"></i> Función
                                        </button>
                                    </div>
                                    <div id="funciones-compositor">
                                        <div class="mb-2" data-subcampo="funcion-compositor-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$e</span>
                                                <select name="funcion_compositor_e_0" class="form-select form-select-sm">
                                                    <option value="arreglista">Arreglista</option>
                                                    <option value="coeditor">Coeditor</option>
                                                    <option value="compilador">Compilador</option>
                                                    <option value="compositor" selected>Compositor</option>
                                                    <option value="copista">Copista</option>
                                                    <option value="dedicatario">Dedicatario</option>
                                                    <option value="editor">Editor</option>
                                                    <option value="prologuista">Prologuista</option>
                                                </select>
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('funcion-compositor-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $j - Atribución (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$j Calificador de Atribución</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarAtribucionCompositor()">
                                            <i class="bi bi-plus"></i> Atribución
                                        </button>
                                    </div>
                                    <div id="atribuciones-compositor">
                                        <div class="mb-2" data-subcampo="atribucion-compositor-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$j</span>
                                                <select name="atribucion_compositor_j_0" class="form-select form-select-sm">
                                                    <option value="atribuida">Atribuida</option>
                                                    <option value="certificada" selected>Certificada</option>
                                                    <option value="erronea">Errónea</option>
                                                </select>
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('atribucion-compositor-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 130 - TÍTULO UNIFORME (con subcampos repetibles) -->
                            <div class="mb-4">
                                <h3 class="h6 mb-3">130 - Título Uniforme</h3>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-12">
                                        <label class="form-label small">$a Título Uniforme</label>
                                        <input type="text" name="titulo_uniforme_130_a" class="form-control" 
                                               placeholder="Ej: Sinfonías">
                                    </div>
                                </div>

                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label small">$r Clave Musical</label>
                                        <input type="text" name="titulo_uniforme_130_r" class="form-control" 
                                               placeholder="Ej: Do menor">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small">Indicador 1 - Caracteres a Ignorar</label>
                                        <input type="number" name="titulo_uniforme_130_ind1" class="form-control" 
                                               min="0" max="9" value="0" placeholder="0-9">
                                    </div>
                                </div>

                                <!-- Subcampo $k - Forma (Repetible) -->
                                <div class="subcampo-group">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$k Subencabezamiento de Forma</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarForma130()">
                                            <i class="bi bi-plus"></i> Forma
                                        </button>
                                    </div>
                                    <div id="formas-130">
                                        <div class="mb-2" data-subcampo="forma-130-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$k</span>
                                                <input type="text" name="forma_130_k_0" class="form-control" 
                                                       placeholder="Ej: Selección, Fragmento, Adaptación">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('forma-130-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $m - Medio de Interpretación (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$m Medio de Interpretación</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarMedioInterpretacion130()">
                                            <i class="bi bi-plus"></i> Medio
                                        </button>
                                    </div>
                                    <div id="medios-interpretacion-130">
                                        <div class="mb-2" data-subcampo="medio-interpretacion-130-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$m</span>
                                                <input type="text" name="medio_interpretacion_130_m_0" class="form-control" 
                                                       placeholder="Ej: piano, orquesta, cuarteto de cuerdas" value="piano">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('medio-interpretacion-130-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $n - Número de Parte (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$n Número de Parte/Sección</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarNumeroParteSeccion130()">
                                            <i class="bi bi-plus"></i> Número
                                        </button>
                                    </div>
                                    <div id="numeros-parte-130">
                                        <div class="mb-2" data-subcampo="numero-parte-130-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$n</span>
                                                <input type="text" name="numero_parte_130_n_0" class="form-control" 
                                                       placeholder="Ej: I, II, III o 1, 2, 3">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('numero-parte-130-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $p - Nombre de Parte (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$p Nombre de Parte/Sección</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarNombreParteSeccion130()">
                                            <i class="bi bi-plus"></i> Nombre
                                        </button>
                                    </div>
                                    <div id="nombres-parte-130">
                                        <div class="mb-2" data-subcampo="nombre-parte-130-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$p</span>
                                                <input type="text" name="nombre_parte_130_p_0" class="form-control" 
                                                       placeholder="Ej: Allegro, Andante, Finale">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('nombre-parte-130-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 240 - TÍTULO UNIFORME CON COMPOSITOR (con subcampos repetibles) -->
                            <div class="mb-4">
                                <h3 class="h6 mb-3">240 - Título Uniforme (con Compositor en 100)</h3>
                                <div class="alert alert-info" role="alert">
                                    <i class="bi bi-info-circle"></i>
                                    <small>Usar este campo cuando se haya ingresado un compositor en el campo 100.</small>
                                </div>
                                
                                <div class="row g-3 mb-3">
                                    <div class="col-md-12">
                                        <label class="form-label small">$a Título Uniforme</label>
                                        <input type="text" name="titulo_uniforme_240_a" class="form-control" 
                                               placeholder="Ej: Sonatas">
                                    </div>
                                </div>

                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label small">$r Clave Musical</label>
                                        <input type="text" name="titulo_uniforme_240_r" class="form-control" 
                                               placeholder="Ej: Re mayor">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small">Indicador 1 - Control de Impresión</label>
                                        <select name="titulo_uniforme_240_ind1" class="form-select">
                                            <option value="0">0 - No imprimir/no mostrar punto de acceso</option>
                                            <option value="1" selected>1 - Imprimir/mostrar punto de acceso</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Subcampo $k - Forma (Repetible) -->
                                <div class="subcampo-group">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$k Subencabezamiento de Forma</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarForma240()">
                                            <i class="bi bi-plus"></i> Forma
                                        </button>
                                    </div>
                                    <div id="formas-240">
                                        <div class="mb-2" data-subcampo="forma-240-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$k</span>
                                                <select name="forma_240_k_0" class="form-select form-select-sm">
                                                    <option value="adaptación">Adaptación</option>
                                                    <option value="boceto">Boceto</option>
                                                    <option value="fragmento">Fragmento</option>
                                                    <option value="selección" selected>Selección</option>
                                                    <option value="tema con variaciones">Tema con variaciones</option>
                                                </select>
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('forma-240-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $m - Medio de Interpretación (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$m Medio de Interpretación</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarMedioInterpretacion240()">
                                            <i class="bi bi-plus"></i> Medio
                                        </button>
                                    </div>
                                    <div id="medios-interpretacion-240">
                                        <div class="mb-2" data-subcampo="medio-interpretacion-240-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$m</span>
                                                <input type="text" name="medio_interpretacion_240_m_0" class="form-control" 
                                                       placeholder="Ej: piano, orquesta, cuarteto de cuerdas" value="piano">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('medio-interpretacion-240-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $n - Número de Parte (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$n Número de Parte/Sección</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarNumeroParteSeccion240()">
                                            <i class="bi bi-plus"></i> Número
                                        </button>
                                    </div>
                                    <div id="numeros-parte-240">
                                        <div class="mb-2" data-subcampo="numero-parte-240-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$n</span>
                                                <input type="text" name="numero_parte_240_n_0" class="form-control" 
                                                       placeholder="Ej: I, II, III o 1, 2, 3">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('numero-parte-240-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subcampo $p - Nombre de Parte (Repetible) -->
                                <div class="subcampo-group mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="subcampo-label mb-0">$p Nombre de Parte/Sección</label>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarNombreParteSeccion240()">
                                            <i class="bi bi-plus"></i> Nombre
                                        </button>
                                    </div>
                                    <div id="nombres-parte-240">
                                        <div class="mb-2" data-subcampo="nombre-parte-240-0">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">$p</span>
                                                <input type="text" name="nombre_parte_240_p_0" class="form-control" 
                                                       placeholder="Ej: Allegro, Andante, Finale">
                                                <button type="button" class="btn btn-outline-danger" onclick="eliminarSubcampo('nombre-parte-240-0')">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card border-0 shadow-sm mb4" id="bloque-5xx">

                    </div>
                    <div class="card border-0 shadow-sm mb4" id="bloque-6xx">

                    </div>
                    
                    
                    <!-- Botones -->
                    <div class="d-flex gap-2 justify-content-end">
                        <a href="{% url 'index' %}" class="btn btn-outline-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Guardar Obra
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar de navegación -->
        <div class="sidebar-nav">
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Navegación</div>
                    <a href="#cabecera" class="nav-link active">Cabecera</a>
                    <a href="#bloque-0xx" class="nav-link">0XX - Campos de Control</a>
                    <a href="#bloque-1xx" class="nav-link">1XX - Entradas Principales</a>
                    <a href="#bloque-5xx" class="nav-link">5xx - Notas Generales</a>
                    <a href="#bloque-6xx" class="nav-link">6xx - Materias y Géneros</a>
                </div>
            </nav>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'catalogacion/js/campos-core.js' %}"></script>

<!-- BLOQUES  -->
<script src="{% static 'catalogacion/js/campos-0xx-repetibles.js' %}"></script>
<script src="{% static 'catalogacion/js/campos-1xx-repetibles.js' %}?v=2.0"></script>
<script src="{% static 'catalogacion/js/campos-5xx-repetibles.js' %}"></script>
<script src="{% static 'catalogacion/js/campos-6xx-repetibles.js' %}"></script>
<script src="{% static 'catalogacion/js/campos-8xx-repetibles.js' %}"></script>
<!-- 
    <script src="{% static 'catalogacion/js/campos-2xx-repetibles.js' %}"></script>
    <script src="{% static 'catalogacion/js/campos-3xx-repetibles.js' %}"></script>
    <script src="{% static 'catalogacion/js/campos-7xx-repetibles.js' %}"></script>
    -->

<!-- 3. INICIALIZACIÓN -->
<script src="{% static 'catalogacion/js/obra-general-init.js' %}"></script>
{% endblock %}